<!doctype html>
<html>
  <head>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="{{ url_for('static', filename='favicon/apple-touch-icon.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="{{ url_for('static', filename='favicon/favicon-32x32.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="{{ url_for('static', filename='favicon/favicon-16x16.png') }}"
    />
    <link
      rel="manifest"
      href="{{ url_for('static', filename='favicon/site.webmanifest') }}"
    />
    <link
      rel="mask-icon"
      href="{{ url_for('static', filename='favicon/safari-pinned-tab.svg') }}"
      color="#5bbad5"
    />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />
    <title>Playlist - {{ playlist_data['id'] }}</title>
    <script>
      var yearCountData = JSON.parse('{{ year_count | safe }}');
    </script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/spec_playlist.css') }}"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body>
    <a href="https://rawcsav.com" class="homepage-link">
      <img
        src="https://res.cloudinary.com/dn9bcrimg/image/upload/v1695251723/RawcSavLogo_iiq03n.png"
        alt="Homepage"
      />
    </a>
    <div class="top-right-nav">
      <a href="https://webstats.rawcsav.com/playlist" class="profile-link">
        Back to Playlists
      </a>
    </div>
    <h1>{{ playlist_data['name'] }}</h1>

    <div id="summary-stats" class="data-view">
      <div class="top-section">
        <div class="playlist-container">
          <img
            class="playlist-cover"
            src="{{ playlist_data['cover_art'] }}"
            alt="Playlist Cover"
          />
          <div class="playlist-desc">
            <p class="total-tracks">{{ total_tracks }} Tracks</p>
            <p class="is-collaborative">
              {% if is_collaborative %} Collaborative: Yes {% endif %}
            </p>
            <p class="is-public">{{ "Public" if is_public else "Private" }}</p>
          </div>
        </div>
        <div class="button-group">
          <button class="data-view-btn active" id="summary-stats-btn">
            Summary Stats
          </button>
          <button class="data-view-btn" id="genre-counts-btn">
            Genre Stats
          </button>
          <button class="data-view-btn" id="feature-stats-btn">
            Feature Stats
          </button>
        </div>
      </div>
      <div class="bottom-section">
        <div class="chart-flex">
          <h3 class="decade-title">Tracks by Decade</h3>
          <div class="chart-container">
            <canvas id="YrPieChart" class="year-pie-chart"></canvas>
            <div class="oldest-newest-tracks">
              <p class="oldest-track">
                Oldest: {{ playlist_data['temporal_stats']['oldest_track'] }} by
                {{ playlist_data['temporal_stats']['oldest_track_artist'] }} ({{
                playlist_data['temporal_stats']['oldest_track_date'] }})
              </p>
              <p class="newest-track">
                Newest: {{ playlist_data['temporal_stats']['newest_track'] }} by
                {{ playlist_data['temporal_stats']['newest_track_artist'] }} ({{
                playlist_data['temporal_stats']['newest_track_date'] }})
              </p>
            </div>
          </div>
        </div>
        <div class="artist-flex">
          <h3 class="top-artists-title">Top Artists</h3>
          <div class="artist-list">
            {% for artist, count, image_url, spotify_url in
            playlist_data.top_artists %}
            <li class="artist-item">
              <div class="artist-container">
                <!-- Use the artist's Spotify URL to create the clickable link for the image -->
                <a
                  href="{{ spotify_url }}"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <img
                    class="artist-image"
                    src="{{ image_url }}"
                    alt="{{ artist }}'s picture"
                  />
                </a>
                <div class="overlay">
                  <span class="artist-name">{{ artist }}</span>
                  <span class="artist-count">{{ count }} Tracks</span>
                </div>
              </div>
            </li>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <div id="genre-counts" class="data-view" style="display: none">
      <h2>Genre Counts</h2>
      <ul>
        {% for genre, count in playlist_data.genre_counts|dictsort(reverse=True,
        by='value') %}
        <li>{{ genre }}: {{ count }}</li>
        {% endfor %}
      </ul>
    </div>
    <div id="feature-stats" class="data-view" style="display: none">
      <h2>Feature Stats</h2>
      <ul>
        {% for feature, stats in playlist_data.feature_stats.items() %}
        <li>
          {{ feature }}:
          <ul>
            <li>Min: {{ stats['min'][1] }} ({{ stats['min'][0] }})</li>
            <li>Max: {{ stats['max'][1] }} ({{ stats['max'][0] }})</li>
            <li>Avg: {{ stats['avg'] }}</li>
          </ul>
        </li>
        {% endfor %}
      </ul>
    </div>
  </body>
  <script src="{{ url_for('static', filename='js/spec_playlist.js') }}"></script>
</html>
